<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Carpitalist Game</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script type="text/javascript" src="utils.js"></script>
<script type="text/javascript" src="music.js"></script>
<script type="text/javascript" src="constants.js"></script>
<script type="text/javascript" src="carp.js"></script>
<script type="text/javascript" src="fishes.js"></script>
<script type="text/javascript" src="score.js"></script>
<script type="text/javascript" src="health.js"></script>
<script type="text/javascript">
  var config = {
      type: Phaser.AUTO,
      width: screenWidth,
      height: screenHeight,
      physics: {
          default: 'arcade',
          arcade: {
              gravity: { y: 0 },
              debug: false
          }
      },
      scene: {
          preload: preload,
          create: create,
          update: update
      }
  };

  var game = new Phaser.Game(config);

  function preload ()
  {
      this.load.spritesheet('carp', 'assets/carp_sprite_new.png', { frameWidth: 333, frameHeight: 256 });
      this.load.audio('title', ['assets/music.mp3']);

      for (const background of backgrounds) {
        this.load.image(background, `assets/${background}.png`);
      }

      for (const direction of ['_left', '_right']) {
        for (const model of fishModels) {
          this.load.image(`${model}${direction}`, `assets/${model}${direction}.png`);
        }
      }

      this.load.image('heart', 'assets/heart.png');
  }

  function create () {
      this.add.image(600, 450, backgrounds[0]);
      initialize(this);

      fishes = this.physics.add.group();

      setInterval(() => {
        generateRandomFish(this);
      }, randomValueBetween(1, 2) * 1000);

  }

  function update () {
    handleCarpMovements()
  }

  const initialize = (scene) => {
    // initMusic(scene);
    initCarp(scene);
    initScore(scene);
    initHealthBar(scene);
  }
</script>

</body>
</html>